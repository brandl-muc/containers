language: cpp

compiler:
  - g++
os:
  - linux

addons:
  apt:
    sources:
#      - llvm-toolchain-precise
      - ubuntu-toolchain-r-test
    packages:
#      - clang-3.7
      - g++-5
      - gcc-5
      - lcov

before_install:
    # Switch to gcc 5
  - sudo unlink /usr/bin/gcc && sudo ln -s /usr/bin/gcc-5 /usr/bin/gcc
  - sudo unlink /usr/bin/g++ && sudo ln -s /usr/bin/g++-5 /usr/bin/g++
  - sudo unlink /usr/bin/gcov && sudo ln -s /usr/bin/gcov-5 /usr/bin/gcov
  - g++ --version
  - gcov --version
    # Get googletest 1.7.0
  - sudo wget https://github.com/google/googletest/archive/release-1.7.0.tar.gz
  - sudo tar xf release-1.7.0.tar.gz
  - cd googletest-release-1.7.0
  - sudo cmake -DBUILD_SHARED_LIBS=ON .
  - sudo make
  - sudo cp -a include/gtest /usr/include
  - sudo cp -a libgtest_main.so libgtest.so /usr/lib/
    # Installing lcov
  - cd ${TRAVIS_BUILD_DIR}
  - wget http://ftp.de.debian.org/debian/pool/main/l/lcov/lcov_1.13.orig.tar.gz
  - tar xf lcov_1.13.orig.tar.gz
  - cd lcov-1.13/
  - sudo make install
  - cd ..
  - lcov --version
  - cd "${TRAVIS_BUILD_DIR}"
before_script:
  - cd test/
  - cmake -DCMAKE_BUILD_TYPE=Debug CMakeLists.txt
script:
  - make coverage
after_success:
    # Creating report
  - cd ${TRAVIS_BUILD_DIR}
  - lcov --directory . --capture --output-file coverage.info # capture coverage info
  - lcov --remove coverage.info '/usr/*' --output-file coverage.info # filter out system
  - lcov --list coverage.info #debug info
    # Uploading report to CodeCov
  - bash <(curl -s https://codecov.io/bash) || echo "Codecov did not collect coverage reports"
branches:
  only:
    - master
    - develop
addons:
  apt:
    sources:
      - ubuntu-toolchain-r-test
    packages:
      - gcc-5
      - g++-5
notifications:
  recipients:
    - brandl.matthaeus@gmail.com
  email:
    on_success: never
    on_failure: change
